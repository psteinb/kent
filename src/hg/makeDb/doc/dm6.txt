# for emacs: -*- mode: sh; -*-

# This file describes browser build for the dm6
# Drosophila melanogaster -- BDGP Release 6.0 + ISO1 MT (Aug, 2014)
#  The FlyBase Consortium/Berkeley Drosophila Genome Project/Celera Genomics
#  BDGP Release 6 + ISO1 MT


#############################################################################
# fetch sequence from new style download directory (DONE - 2014-08-27 - Hiram)
    # NCBI has redesigned their FTP download site, new type of address
    #      and naming scheme
    mkdir -p /hive/data/genomes/dm6/genbank
    cd /hive/data/genomes/dm6/genbank

    rsync -L -a -P rsync://ftp.ncbi.nlm.nih.gov/genomes/genbank/invertebrate/Drosophila_melanogaster/latest_assembly_versions/GCA_000001215.4_Release_6_plus_ISO1_MT/ ./

    # measure what we have here:
    faSize GCA_000001215.4_Release_6_plus_ISO1_MT_assembly_structure/Primary_Assembly/assembled_chromosomes/FASTA/*.fna.gz \
     GCA_000001215.4_Release_6_plus_ISO1_MT_assembly_structure/non-nuclear/assembled_chromosomes/FASTA/chrMT.fna.gz \
     GCA_000001215.4_Release_6_plus_ISO1_MT_assembly_structure/Primary_Assembly/unplaced_scaffolds/FASTA/*.fna.gz \
GCA_000001215.4_Release_6_plus_ISO1_MT_assembly_structure/Primary_Assembly/unlocalized_scaffolds/FASTA/*.fna.gz

    # 143726002 bases (1152978 N's 142573024 real 142573024 upper 0 lower)
    #  in 1870 sequences in 11 files
    # Total size: mean 76858.8 sd 1382100.2 min 544 (DS485566.2)
    #   max 32079331 (AE014297.3) median 1577

#############################################################################
# fixup to UCSC naming scheme (DONE - 2014-08-27 - Hiram)
    mkdir /hive/data/genomes/dm6/ucsc
    cd /hive/data/genomes/dm6/ucsc
    # evolving these scripts over time, could become source tree scripts

    cat << '_EOF_' > ucscCompositeAgp.pl
#!/bin/env perl

use strict;
use warnings;

my %accToChr;

my $primary="../genbank/GCA_000001215.4_Release_6_plus_ISO1_MT_assembly_structure/Primary_Assembly";

open (FH, "<$primary/assembled_chromosomes/chr2acc") or
        die "can not read Primary_Assembly/assembled_chromosomes/chr2acc";
while (my $line = <FH>) {
    next if ($line =~ m/^#/);
    chomp $line;
    my ($chrN, $acc) = split('\s+', $line);
    $accToChr{$acc} = $chrN;
}
close (FH);

foreach my $acc (keys %accToChr) {
    my $chrN =  $accToChr{$acc};
    print "$acc $accToChr{$acc}\n";
    open (FH, "zcat $primary/assembled_chromosomes/AGP/chr${chrN}.comp.agp.gz|") or die "can not read chr${chrN}.comp.agp.gz";
    open (UC, ">chr${chrN}.agp") or die "can not write to chr${chrN}.agp";
    while (my $line = <FH>) {
        if ($line =~ m/^#/) {
            print UC $line;
        } else {
            $line =~ s/^$acc/chr${chrN}/;
            print UC $line;
        }
    }
    close (FH);
    close (UC);
    open (FH, "zcat $primary/assembled_chromosomes/FASTA/chr${chrN}.fna.gz|") or die "can not read chr${chrN}.fna.gz";
    open (UC, ">chr${chrN}.fa") or die "can not write to chr${chrN}.fa";
    while (my $line = <FH>) {
        if ($line =~ m/^>/) {
            printf UC ">chr${chrN}\n";
        } else {
            print UC $line;
        }
    }
    close (FH);
    close (UC);
}
'_EOF_'
    # << happy emacs

    cat << '_EOF_' > unlocalized.pl
#!/bin/env perl

use strict;
use warnings;

my %accToChr;
my %chrNames;

my $primary="../genbank/GCA_000001215.4_Release_6_plus_ISO1_MT_assembly_structure/Primary_Assembly";

open (FH, "<$primary/unlocalized_scaffolds/unlocalized.chr2scaf") or
        die "can not read Primary_Assembly/unlocalized_scaffolds/unlocalized.chr2scaf";
while (my $line = <FH>) {
    next if ($line =~ m/^#/);
    chomp $line;
    my ($chrN, $acc) = split('\s+', $line);
    $acc =~ s/\./v/;
    $accToChr{$acc} = $chrN;
    $chrNames{$chrN} += 1;
}
close (FH);

foreach my $chrN (keys %chrNames) {
    my $agpFile =  "$primary/unlocalized_scaffolds/AGP/chr$chrN.unlocalized.scaf.agp.gz";
    my $fastaFile =  "$primary/unlocalized_scaffolds/FASTA/chr$chrN.unlocalized.scaf.fna.gz";
    open (FH, "zcat $agpFile|") or die "can not read $agpFile";
    open (UC, ">chr${chrN}_random.agp") or die "can not write to chr${chrN}_random.agp";
    while (my $line = <FH>) {
        if ($line =~ m/^#/) {
            print UC $line;
        } else {
            chomp $line;
            my (@a) = split('\t', $line);
            my $acc = $a[0];
            $acc =~ s/\./v/;
            die "ERROR: chrN $chrN not correct for $acc"
                if ($accToChr{$acc} ne $chrN);
            my $ucscName = "chr${chrN}_${acc}_random";
            printf UC "%s", $ucscName;
            for (my $i = 1; $i < scalar(@a); ++$i) {
                printf UC "\t%s", $a[$i];
            }
            printf UC "\n";
        }
    }
    close (FH);
    close (UC);
    printf "chr%s\n", $chrN;
    open (FH, "zcat $fastaFile|") or die "can not read $fastaFile";
    open (UC, ">chr${chrN}_random.fa") or die "can not write to chr${chrN}_random.fa";
    while (my $line = <FH>) {
        if ($line =~ m/^>/) {
            chomp $line;
            my $acc = $line;
            $acc =~ s/ .*//;
            $acc =~ s/\./v/;
            $acc =~ s/>//;
            die "ERROR: chrN $chrN not correct for $acc"
                if ($accToChr{$acc} ne $chrN);
            my $ucscName = "chr${chrN}_${acc}_random";
            printf UC ">$ucscName\n";
        } else {
            print UC $line;
        }
    }
    close (FH);
    close (UC);
}
'_EOF_'
    # << happy emacs

    cat << '_EOF_' > unplaced.pl
#!/bin/env perl

use strict;
use warnings;

my $primary="../genbank/GCA_000001215.4_Release_6_plus_ISO1_MT_assembly_structure/Primary_Assembly";

my $agpFile =  "$primary/unplaced_scaffolds/AGP/unplaced.scaf.agp.gz";
my $fastaFile =  "$primary/unplaced_scaffolds/FASTA/unplaced.scaf.fna.gz";
open (FH, "zcat $agpFile|") or die "can not read $agpFile";
open (UC, ">chrUn.agp") or die "can not write to chrUn.agp";
while (my $line = <FH>) {
    if ($line =~ m/^#/) {
        print UC $line;
    } else {
        $line =~ s/\./v/;
        printf UC "chrUn_%s", $line;
    }
}
close (FH);
close (UC);

open (FH, "zcat $fastaFile|") or die "can not read $fastaFile";
open (UC, ">chrUn.fa") or die "can not write to chrUn.fa";
while (my $line = <FH>) {
    if ($line =~ m/^>/) {
        chomp $line;
        $line =~ s/ .*//;
        $line =~ s/\./v/;
        $line =~ s/>//;
        printf UC ">chrUn_$line\n";
    } else {
        print UC $line;
    }
}
close (FH);
close (UC);
'_EOF_'
    # << happy emacs

    chmod +x ucscCompositeAgp.pl unlocalized.pl unplaced.pl
    ./ucscCompositeAgp.pl
    ./unlocalized.pl
    ./unplaced.pl

    zcat ../genbank/GCA_000001215.4_Release_6_plus_ISO1_MT_assembly_structure/non-nuclear/assembled_chromosomes/AGP/chrMT.comp.agp.gz \
        | grep -v "^#" | sed -e 's/^KJ947872.2/chrM/' > chrM.agp

    zcat ../genbank/GCA_000001215.4_Release_6_plus_ISO1_MT_assembly_structure/non-nuclear/assembled_chromosomes/FASTA/chrMT.fna.gz \
        | sed -e 's/^>.*/>chrM/' > chrM.fa

    # verify this sequence is still the same as it was before
    #  these translations
    faSize *.fa

    # 143726002 bases (1152978 N's 142573024 real 142573024 upper 0 lower)
    #   in 1870 sequences in 11 files
    # Total size: mean 76858.8 sd 1382100.2 min 544 (chrUn_DS485566v2)
    #   max 32079331 (chr3R) median 1577

#############################################################################
# pick up photo (DONE - 2014-06-06 - Chin)
    mkdir /hive/data/genomes/dm6/photo
    cd /hive/data/genomes/dm6/photo
    wget --timestamping \
http://upload.wikimedia.org/wikipedia/commons/1/1d/Drosophila_melanogaster.jpg

    convert -geometry "190x300" Drosophila_melanogaster.jpg New-Drosophila_melanogaster.jpg

    # check in the New-Drosophila_melanogaster.jpg file into
    # the source tree:
# -rw-rw-r-- 1 9842 Jun  6 14:55 Drosophila_melanogaster.jpg

    # and get that installed in /usr/local/apache/htdocs/images/

#############################################################################
#  Initial database build (DONE - 2014-08-28 - Hiram)

    cd /hive/data/genomes/dm6
    cat << '_EOF_' > dm6.config.ra
# Config parameters for makeGenomeDb.pl:
db dm6
clade insect
genomeCladePriority 10
scientificName Drosophila melanogaster
commonName D. melanogaster
assemblyDate Aug. 2014
assemblyLabel The FlyBase Consortium/Berkeley Drosophila Genome Project/Celera Genomics
assemblyShortLabel BDGP Release 6 + ISO1 MT
orderKey 9060
# chrM mito sequence KJ947872.2 included
mitoAcc none
fastaFiles /hive/data/genomes/dm6/ucsc/chr*.fa
agpFiles /hive/data/genomes/dm6/ucsc/chr*.agp
# qualFiles /dev/null
dbDbSpeciesDir drosophila
photoCreditURL http://de.wikipedia.org/wiki/Benutzer:Mr.checker
photoCreditName Wikimedia Commons/Mr.checker
ncbiGenomeId 47
ncbiAssemblyId 202931
ncbiAssemblyName BDGP Release 6 + ISO1 MT
ncbiBioProject 164
genBankAccessionID GCA_000001215.4
taxId 7227
'_EOF_'
    # << happy emacs

    # stepwise to verify sequence and AGP file
    time makeGenomeDb.pl -workhorse=hgwdev -dbHost=hgwdev -fileServer=hgwdev \
	-stop=seq dm6.config.ra > seq.log 2>&1
    # real    0m9.989s

    # verify sequence and AGP are OK:
    time makeGenomeDb.pl -workhorse=hgwdev -dbHost=hgwdev -fileServer=hgwdev \
	-continue=agp -stop=agp dm6.config.ra > agp.log 2>&1
    # real    0m4.901s

    # then finish it off:
    time nice -n +19 makeGenomeDb.pl -workhorse=hgwdev -dbHost=hgwdev \
       -fileServer=hgwdev -continue=db dm6.config.ra > db.log 2>&1
    # real    1m27.449s

##########################################################################
# running repeat masker (DONE - 2014-08-28 - Hiram)
    mkdir /hive/data/genomes/dm6/bed/repeatMasker
    cd /hive/data/genomes/dm6/bed/repeatMasker
    time  doRepeatMasker.pl -buildDir=`pwd` \
	-bigClusterHub=ku -dbHost=hgwdev -workhorse=hgwdev \
	-smallClusterHub=ku dm6 > do.log 2>&1 &
    # real     44m51.83

    cat faSize.rmsk.txt
    # 143726002 bases (1152978 N's 142573024 real 112610723 upper
    #    29962301 lower) in 1870 sequences in 1 files
    # Total size: mean 76858.8 sd 1382100.2 min 544 (chrUn_DS485566v2)
    #   max 32079331 (chr3R) median 1577
    # %20.85 masked total, %21.02 masked real

    egrep -i "versi|relea" do.log
    # RepeatMasker version open-4.0.5
    #    January 31 2015 (open-4-0-5) version of RepeatMasker
    # CC   RELEASE 20140131;

    featureBits -countGaps dm6 rmsk
    # 29968013 bases of 143726002 (20.851%) in intersection
    # why is it different than the faSize above ?
    # because rmsk masks out some N's as well as bases, the count above
    #	separates out the N's from the bases, it doesn't show lower case N's

##########################################################################
# running simple repeat (DONE 2014-08-28 - Hiram)
    mkdir /hive/data/genomes/dm6/bed/simpleRepeat
    cd /hive/data/genomes/dm6/bed/simpleRepeat
    time doSimpleRepeat.pl -buildDir=`pwd` -bigClusterHub=ku \
	-dbHost=hgwdev -workhorse=hgwdev -smallClusterHub=ku \
	dm6 > do.log 2>&1 &
    #  real    23m17.471s

    cat fb.simpleRepeat
    #  3925949 bases of 142573024 (2.754%) in intersection

    # add to rmsk after it is done:
    cd /hive/data/genomes/dm6
    twoBitMask dm6.rmsk.2bit \
	-add bed/simpleRepeat/trfMask.bed dm6.2bit
    #	you can safely ignore the warning about fields >= 13

    twoBitToFa dm6.2bit stdout | faSize stdin > faSize.dm6.2bit.txt
    cat faSize.dm6.2bit.txt
    # 143726002 bases (1152978 N's 142573024 real 112531045 upper
    #   30041979 # lower) in 1870 sequences in 1 files
    # Total size: mean 76858.8 sd 1382100.2 min 544 (chrUn_DS485566v2)
    #   max 32079331 (chr3R) median 1577
    # %20.90 masked total, %21.07 masked real

    rm /gbdb/dm6/dm6.2bit
    ln -s `pwd`/dm6.2bit /gbdb/dm6/dm6.2bit

#########################################################################
# Verify all gaps are marked, add any N's not in gap as type 'other'
#	(DONE 2014-08-28 - Hiram)
    mkdir /hive/data/genomes/dm6/bed/gap
    cd /hive/data/genomes/dm6/bed/gap
    time nice -n +19 findMotif -motif=gattaca -verbose=4 \
	-strand=+ ../../dm6.unmasked.2bit > findMotif.txt 2>&1
    #	real    0m1.290s
    grep "^#GAP " findMotif.txt | sed -e "s/^#GAP //" > allGaps.bed
    time featureBits -countGaps dm6 -not gap -bed=notGap.bed
    # 143726002 bases of 143726002 (100.000%) in intersection


    featureBits dm6 -not gap -bed=notGap.bed allGaps.bed
    time featureBits -countGaps dm6 allGaps.bed notGap.bed -bed=new.gaps.bed
    # 143726002 bases of 143726002 (100.000%) in intersection
    time featureBits -countGaps dm6 allGaps.bed notGap.bed -bed=new.gaps.bed
    # 1152978 bases of 143726002 (0.802%) in intersection

    # there are some very large gaps that are unannotated:
    awk '{print $3-$2,$0}' new.gaps.bed  | sort -rn | head
    # 53860 chr3L     26952525        27006385        chr3L.7
    # 53800 chr3L     26882321        26936121        chr3L.6
    # 32000 chrX      22317804        22349804        chrX.5

    # the original 'component' AGP files have zero annotations in
    # the chromosomes.  In fact, there are no gaps annotated:
    hgsql -e 'select count(*) from gap;' dm6
#   +----------+
#   | count(*) |
#   +----------+
#   |        0 |
#   +----------+

    #	what is the highest index in the existing gap table:
    hgsql -N -e "select ix from gap;" dm6 | sort -n | tail -1
    #	(no output, assume 0)
    cat << '_EOF_' > mkGap.pl
#!/bin/env perl

use strict;
use warnings;

my $ix=0;

open (FH,"<new.gaps.bed") or die "can not read new.gaps.bed";
while (my $line = <FH>) {
    my ($chrom, $chromStart, $chromEnd, $rest) = split('\s+', $line);
    ++$ix;
    printf "%s\t%d\t%d\t%d\tN\t%d\tother\tyes\n", $chrom, $chromStart,
        $chromEnd, $ix, $chromEnd-$chromStart;
}
close (FH);
'_EOF_'
    # << happy emacs
    chmod +x ./mkGap.pl
    ./mkGap.pl > other.bed
    featureBits -countGaps dm6 other.bed
    #  1152978 bases of 143726002 (0.802%) in intersection

    wc -l other.bed
    #	572
    hgLoadBed -sqlTable=$HOME/kent/src/hg/lib/gap.sql \
	-noLoad dm6 otherGap other.bed
    #   Read 572 elements of size 8 from other.bed
    #	starting with this many
    hgsql -e "select count(*) from gap;" dm6
    #	 0
    hgsql dm6 -e 'load data local infile "bed.tab" into table gap;'
    #	result count:
    hgsql -e "select count(*) from gap;" dm6
    #	572
    # == 0 + 572
    # verify we aren't adding gaps where gaps already exist
    # this would output errors if that were true:
    gapToLift -minGap=1 dm6 nonBridged.lift -bedFile=nonBridged.bed
    # see example in danRer7.txt
    # there are no non-bridged gaps here:
    hgsql -N -e "select bridge from gap;" dm6 | sort | uniq -c
    #    572 yes

##########################################################################
## WINDOWMASKER (DONE - 2014-08-28 - Hiram)
    mkdir /hive/data/genomes/dm6/bed/windowMasker
    cd /hive/data/genomes/dm6/bed/windowMasker
    time nice -n +19 doWindowMasker.pl -buildDir=`pwd` -workhorse=hgwdev \
	-dbHost=hgwdev dm6 > do.log 2>&1 &
    #  real    6m13.489s

    # Masking statistics
    cat faSize.dm6.cleanWMSdust.txt
    #  143726002 bases (1152978 N's 142573024 real 108961589 upper
    #    33611435  lower) in 1870 sequences in 1 files
    # Total size: mean 76858.8 sd 1382100.2 min 544 (chrUn_DS485566v2)
    #   max 32079331 (chr3R) median 1577
    # %23.39 masked total, %23.57 masked real

    # how much does this window masker and repeat masker overlap:
    # if RM finished before this got here, the answer is in:
    cat fb.dm6.rmsk.windowmaskerSdust.txt
    # 16809665 bases of 143726002 (11.696%) in intersection

#############################################################################
# cytoBandIdeo - (OBSOLETE, redone below 2014-08-28 - Hiram)
    mkdir /hive/data/genomes/dm6/bed/cytoBand
    cd /hive/data/genomes/dm6/bed/cytoBand
    makeCytoBandIdeo.csh dm6

#########################################################################
# CHROMOSOME BANDS (DONE - 2014-10-09 - Hiram)
    ssh hgwdev
    cd /cluster/data/dm6/bed/cytoBand
    # As of 5.3, the GFF now includes what we need to make cytoBandIdeo
    # directly:

    zgrep chromosome_band ../../flyBase/dmel-all-r6.02.gff.gz > chromBand.gff

    cat << '_EOF_' > gffToBand.pl
#!/usr/bin/env perl

use warnings;
use strict;

open (FH, "<chromBand.gff") or die "can not read chromBand.gff";
while (my $line = <FH>) {
  chomp $line;
  my @w = split('\t', $line);
  $w[3]--;
  $w[3] = 0 if ($w[3] < 0);
  $w[8] =~ s/^.*Name=band-//;
  $w[8] =~ s/[;].*$//;
  if ($w[8] !~ /^\d+[A-Z]\d+$/) { next; }
  if ($w[4] <= 0) { next; }
  printf "chr%s\t%d\t%d\t%s\tn/a\n", $w[0], $w[3], $w[4], $w[8];
}
close (FH);
'_EOF_'
    # << happy emacs
    chmod +x gffToBand.pl
    ./gffToBand.pl > dm6.cytoBand.tab

    # re-use items from the previously loaded cytoBand data to add
    # to the ones defined for the 'real' cytoBand data:
    egrep -v -w "chr2L|chr2R|chr3L|chr3R|chr4|chrX" dm6.cytoBand \
       > dm6.combined.bed
    cat dm6.cytoBand.tab >> dm6.combined.bed

    featureBits -bed=notCovered.bed -not -countGaps dm6 dm6.combined.bed
    awk '{printf "%s\t%d\t%d\tn/a\tgneg\n", $1, $2, $3}' notCovered.bed \
       >> dm6.combined.bed

    featureBits -countGaps dm6 dm6.combined.bed

    maxLen=`awk '{print length($1)}' dm6.combined.bed | sort -rn | head -1`

    sed -e "s/12/${maxLen}/;" ~/kent/src/hg/lib/cytoBand.sql > dm6.cytoBand.sql

    hgLoadSqlTab dm6 cytoBand dm6.cytoBand.sql dm6.combined.bed

    checkTableCoords -verbose=2  dm6 cytoBand

    hgLoadSqlTab dm6 cytoBandIdeo dm6.cytoBand.sql dm6.combined.bed

    checkTableCoords -verbose=2  dm6 cytoBandIdeo

##########################################################################
# cpgIslands - (DONE - 2014-08-28 - Hiram)
    mkdir /hive/data/genomes/dm6/bed/cpgIslands
    cd /hive/data/genomes/dm6/bed/cpgIslands
    time doCpgIslands.pl -dbHost=hgwdev -bigClusterHub=ku \
      -workhorse=hgwdev -smallClusterHub=ku dm6 > do.log 2>&1 &
    #  real    35m11.446s

    cat fb.dm6.cpgIslandExt.txt
    #   15067148 bases of 142573024 (10.568%) in intersection

##############################################################################
# cpgIslands on UNMASKED sequence (DONE - 2014-08-28 - Hiram)
    mkdir /hive/data/genomes/dm6/bed/cpgIslandsUnmasked
    cd /hive/data/genomes/dm6/bed/cpgIslandsUnmasked

    # run stepwise so the loading can be done in a different table
    time doCpgIslands.pl -dbHost=hgwdev -bigClusterHub=ku -buildDir=`pwd` \
       -tableName=cpgIslandExtUnmasked \
          -maskedSeq=/hive/data/genomes/dm6/dm6.unmasked.2bit \
             -workhorse=hgwdev -smallClusterHub=ku dm6 > do.log 2>&1 &
    #  real    40m18.250s

    cat fb.dm6.cpgIslandExtUnmasked.txt
    # 21347147 bases of 142573024 (14.973%) in intersection

#########################################################################
# genscan - (DONE 2014-08-28 - Hiram)
    mkdir /hive/data/genomes/dm6/bed/genscan
    cd /hive/data/genomes/dm6/bed/genscan
    time doGenscan.pl -buildDir=`pwd` -workhorse=hgwdev -dbHost=hgwdev \
      -bigClusterHub=ku dm6 > do.log 2>&1  &
    # real    35m23.353s

    cat fb.dm6.genscan.txt
    #  24277318 bases of 142573024 (17.028%) in intersection

    cat fb.dm6.genscanSubopt.txt
    #  676185 bases of 142573024 (0.474%) in intersection

########################################################################
# MAKE 11.OOC FILE FOR BLAT/GENBANK (DONE 2014-08-28 - Hiram)
    # Use -repMatch=100 (based on size -- for human we use 1024, and
    # fly size is ~4.96% of human judging by gapless dm1 genome size from
    # featureBits -- we would use 50, but bump that up to 100
    # a bit to be more  conservative).
    #  143726002 bases (1152978 N's 142573024 real 108961589 upper
    calc \( 142573024 / 2897316137 \) \* 1024
    # ( 142573024 / 2897316137 ) * 1024 = 50.389661
    # round up to 100

    cd /hive/data/genomes/dm6
    blat dm6.2bit /dev/null /dev/null -tileSize=11 \
      -makeOoc=jkStuff/dm6.11.ooc -repMatch=100
    #	Wrote 4574 overused 11-mers to jkStuff/dm6.11.ooc

    # there are *only* bridged gaps, no lift file needed for genbank
    # Ignore the 2 yes non-bridged gap
    hgsql -N -e "select bridge from gap;" dm6 | sort | uniq -c
    #    572 yes

#########################################################################
# MAKE 11.OOC FILE FOR BLAT (DONE 2014-06-07 - Chin)
# dm3 11.ooc is needed to lift flyBase from dm3 to dm6 for encode3 submission

    # Use -repMatch=100 (based on size -- for human we use 1024, and
    # fly size is ~4.4% of human judging by gapless dm1 genome size from
    # featureBits -- we would use 45, but bump that up a bit to be more
    # conservative).
    cd /hive/data/genomes/dm3
    blat dm3.2bit /dev/null /dev/null -tileSize=11 \
      -makeOoc=jkStuff/dm3.11.ooc -repMatch=100
    # Wrote 7657 overused 11-mers to /hive/data/genomes/dm3/11.ooc

#########################################################################
# dm3 LIFTOVER to dm6 (DONE - 2014-08-28 - Chin)
# will move steps to dm3.txt when dm6 is released.
    sh hgwdev
    cd /hive/data/genomes/dm3
    ln -s jkStuff/dm3.11.ooc 11.ooc

    # -debug run to create run dir, preview scripts...
    doSameSpeciesLiftOver.pl -debug dm3 dm6
    cd /hive/data/genomes/dm3/bed/blat.dm6.2014-08-28

    time nice -n +19 doSameSpeciesLiftOver.pl -verbose=2 \
        -bigClusterHub=ku -dbHost=hgwdev -workhorse=hgwdev \
         dm3 dm6 > do.log 2>&1 &
    # real    22m18.988s

#########################################################################
# LIFTOVER FLYBASE 5.12 ANNOTATIONS FROM DM3 (working 2014-06-09 - Chin)
# NOTE:
# In order to make flyBase gene ui to work, more steps are needed, other wise,
# hgc will shows errors like "Doh, no go for CG3727-RB from flyBasePep"
# all the time. Major objevtive here is to create flyBaseGene tables
# so that we can do featureBits on it for encode3 submission.
    ssh hgwdev
    mkdir /hive/data/genomes/dm6/bed/flybase5.12.liftOver
    cd /hive/data/genomes/dm6/bed/flybase5.12.liftOver
    hgsql dm3 -N -e 'select * from flyBaseGene' | cut -f2- > dm3.flyBaseGene.tab
    liftOver -genePred dm3.flyBaseGene.tab \
      /hive/data/genomes/dm3/bed/liftOver/dm3ToDm6.over.chain.gz \
      flyBaseLiftGene.tab flyBaseLiftGene.unmapped.tab
    wc -l *.tab
    #  21243 dm3.flyBaseGene.tab
    #  21216 flyBaseLiftGene.tab
    #     54 flyBaseLiftGene.unmapped.tab

    ldHgGene -predTab dm6 flyBaseGene flyBaseLiftGene.tab

############################################################################
# set same default position asm dm3 (DONE - 2014-08-28 - Hiram)
    hgsql -e \
'update dbDb set defaultPos="chr2L:826,001-851,000" where name="dm6";' \
     hgcentraltest

############################################################################
# create ucscToINSDC name mapping (DONE - 2014-08-29 - Hiram)
    mkdir /hive/data/genomes/dm6/bed/ucscToINSDC
    cd /hive/data/genomes/dm6/bed/ucscToINSDC

    # this script has been maturing over time, it is close to complete.
    # to find a latest copy of it:
    # ls -ogrt /hive/data/genomes/*/bed/ucscToINSDC/translateNames.sh

    cp /hive/data/genomes/rn6/bed/ucscToINSDC/translateNames.sh .
    # needed to be fixed up here for new genbank organization

    # to see chrM accession:
    hgsql -e 'select * from gold;' dm6 | grep chrM
    # use that accession here:
    ./translateNames.sh KJ947872.2

    awk '{printf "%s\t0\t%d\n", $1,$2}' ../../chrom.sizes | sort \
        > name.coordinate.tab

    join name.coordinate.tab ucscToINSDC.txt | tr '[ ]' '[\t]' > ucscToINSDC.bed

    cut -f1 ucscToINSDC.bed | awk '{print length($0)}' | sort -n | tail -1
# 22

    # use the 22 in this sed:
    sed -e "s/21/22/" $HOME/kent/src/hg/lib/ucscToINSDC.sql \
        | hgLoadSqlTab dm6 ucscToINSDC stdin ucscToINSDC.bed
    checkTableCoords dm6 ucscToINSDC
    # should cover all bases
    featureBits -countGaps dm6 ucscToINSDC
    # 143726002 bases of 143726002 (100.000%) in intersection

#########################################################################
# fixup search rule for assembly track/gold table (DONE - 2014-07-09 - Hiram)
   export maxLen=`hgsql -N -e 'select frag from gold;' dm6 | awk '{print length($0)}' | sort -run | head -1`

   echo $maxLen
   #  10

export C=1
while [ $C -le $maxLen ];
do
  echo -n " $C: "
  hgsql -N -e 'select frag from gold;' dm6 | sort -u \
    | awk '{ print substr($0,'$C',1) }' | sort -u | xargs echo | sed -e 's/ //g'
  C=`echo $C | awk '{print $1+1}'`
done
#  1: ACDK
#  2: EJPS
#  3: 049
#  4: 0148
#  5: 34567
#  6: 0123456789
#  7: 0123456789
#  8: 0123456789
#  9: .
# 10: 123456

    # since we have the composite fragment IDs, there are a variety of
    # dot versions:
    hgsql -N -e 'select frag from gold;' dm6 | sed -e 's/.*\.//' \
       | sort | uniq -c  | sort -rn
#  1861 1
#     3 5
#     3 2
#     1 6
#     1 4
#     1 3

    # hence, add to trackDb/drosophila/dm6/trackDb.ra

searchTable gold
searchMethod prefix
searchType bed
shortCircuit 1
termRegex [ACDK][EJPS][0-9]+(\.[0-9]+)*
query select chrom,chromStart,chromEnd,frag from %s where frag like '%s%%'
searchPriority 8

  # test pattern:
   hgsql -N -e 'select frag from gold;' dm6 | wc -l
   # 1870
   hgsql -N -e 'select frag from gold;' dm6 \
     | egrep -e '[ACDK][EJPS][0-9]+(\.[0-9]+)*' | wc -l
   # 1870
   hgsql -N -e 'select frag from gold;' dm6 \
     | egrep -v -e '[ACDK][EJPS][0-9]+(\.[0-9]+)*' | wc -l
   # 0

############################################################################
# AUTO UPDATE GENBANK (DONE - 2012-05-04 - Hiram)
    # examine the file:
    /cluster/data/genbank/data/organism.lst
    # for your species to see what counts it has for:
# organism       mrnaCnt estCnt  refSeqCnt
# Drosophila melanogaster	61221	821011	30813

    # to decide which "native" mrna or ests you want to specify in genbank.conf

    ssh hgwdev
    cd $HOME/kent/src/hg/makeDb/genbank
    git pull
    # edit etc/genbank.conf to add before dm3 section::

# dm6 (D. melanogaster)
dm6.serverGenome = /hive/data/genomes/dm6/dm6.2bit
dm6.clusterGenome = /hive/data/genomes/dm6/dm6.2bit
dm6.ooc = /hive/data/genomes/dm6/jkStuff/dm6.11.ooc
dm6.lift = no
dm6.refseq.mrna.native.pslCDnaFilter  = ${finished.refseq.mrna.native.pslCDnaFilter}
dm6.refseq.mrna.xeno.pslCDnaFilter    = ${finished.refseq.mrna.xeno.pslCDnaFilter}
dm6.genbank.mrna.native.pslCDnaFilter = ${finished.genbank.mrna.native.pslCDnaFilter}
dm6.genbank.mrna.xeno.pslCDnaFilter   = ${finished.genbank.mrna.xeno.pslCDnaFilter}
dm6.genbank.est.native.pslCDnaFilter  = ${finished.genbank.est.native.pslCDnaFilter}
dm6.genbank.mrna.xeno.load = yes
# dm6.upstreamGeneTbl = refGene
# dm6.upstreamMaf = multiz15way
# /hive/data/genomes/dm3/bed/multiz15way/species.lst

    git commit -m "adding dm6 fly refs #4049" etc/genbank.conf
    git push
    make etc-update

    ssh hgwdev			# used to do this on "genbank" machine
    screen -S dm6           # long running job managed in screen
    cd /cluster/data/genbank
    time nice -n +19 ./bin/gbAlignStep -initial dm6
    #	logFile: var/build/logs/2014.08.29-10:41:04.dm6.initalign.log
    #   real    199m22.304s

    # load database when finished
    ssh hgwdev
    cd /cluster/data/genbank
    time nice -n +19 ./bin/gbDbLoadStep -drop -initialLoad dm6 &
    #	logFile: var/dbload/hgwdev/logs/2014.09.02-11:45:43.dm6.dbload.log
XXX - running - Tue Sep  2 11:46:03 PDT 2014
    #   real    19m24.163s

    # enable daily alignment and update of hgwdev (DONE - 2012-02-09 - Hiram)
    cd ~/kent/src/hg/makeDb/genbank
    git pull
    # add dm6 to:
        etc/align.dbs etc/hgwdev.dbs
    git commit -m "Added dm6 refs #13578" etc/align.dbs etc/hgwdev.dbs
    git push
    make etc-update

#########################################################################
#  BLATSERVERS ENTRY (DONE - 2014-08-29 - Hiram)
#	After getting a blat server assigned by the Blat Server Gods,
    ssh hgwdev

    hgsql -e 'INSERT INTO blatServers (db, host, port, isTrans, canPcr) \
	VALUES ("dm6", "blat4c", "17858", "1", "0"); \
	INSERT INTO blatServers (db, host, port, isTrans, canPcr) \
	VALUES ("dm6", "blat4c", "17859", "0", "1");' \
	    hgcentraltest
    #	test it with some sequence

##############################################################################
# LASTZ D. ananassae DroAna3 (DONE 2014-08-29 - Hiram)
    screen -S droAna3-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroAna3.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroAna3.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. ananassae
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. ananassae
SEQ2_DIR=/hive/data/genomes/droAna3/droAna3.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droAna3/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroAna3.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << this line keeps emacs coloring happy
    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    64m19.065s

    cat fb.dm6.chainDroAna3Link.txt
    # 95925289 bases of 142573024 (67.282%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droAna3/bed/blastz.dm6.swap
    cd /hive/data/genomes/droAna3/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroAna3.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    10m43.121s
    cat fb.droAna3.chainDm6Link.txt
    # 125698535 bases of 213918817 (58.760%) in intersection

###########################################################################
# LASTZ D. sechellia DroSec1 (DONE 2014-08-29 - Hiram)
    screen -S droSec1-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroSec1.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroSec1.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. sechellia
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. sechellia
SEQ2_DIR=/hive/data/genomes/droSec1/droSec1.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droSec1/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroSec1.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    47m43.186s
    cat fb.dm6.chainDroSec1Link.txt
    # 117709624 bases of 142573024 (82.561%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droSec1/bed/blastz.dm6.swap
    cd /hive/data/genomes/droSec1/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroSec1.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    9m56.239s
    cat fb.droSec1.chainDm6Link.txt
    # 128262529 bases of 157238575 (81.572%) in intersection

###########################################################################
# LASTZ D. simulans DroSim1 (DONE 2014-08-29 - Hiram)
    screen -S droSim1-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroSim1.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroSim1.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. simulans
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. simulans
SEQ2_DIR=/hive/data/genomes/droSim1/droSim1.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droSim1/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroSim1.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    39m35.348s
    cat fb.dm6.chainDroSim1Link.txt
    # 114117667 bases of 142573024 (80.042%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droSim1/bed/blastz.dm6.swap
    cd /hive/data/genomes/droSim1/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroSim1.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    6m50.918s
    cat fb.droSim1.chainDm6Link.txt
    # 113676741 bases of 127256433 (89.329%) in intersection

###########################################################################
# LASTZ D. erecta DroEre2 (DONE 2014-08-29 - Hiram)
    screen -S droEre2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroEre2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroEre2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. erecta
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. erecta
SEQ2_DIR=/hive/data/genomes/droEre2/droEre2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droEre2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroEre2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    19m31.724s
    cat fb.dm6.chainDroEre2Link.txt
    # 114091585 bases of 142573024 (80.023%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droEre2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droEre2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroEre2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    8m35.520s
    cat fb.droEre2.chainDm6Link.txt
    # 122430082 bases of 145084019 (84.386%) in intersection

###########################################################################
# LASTZ D. grimshawi DroGri2 (DONE 2014-08-29 - Hiram)
    screen -S droGri2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroGri2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroGri2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. grimshawi
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. grimshawi
SEQ2_DIR=/hive/data/genomes/droGri2/droGri2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droGri2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroGri2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    43m54.742s
    cat fb.dm6.chainDroGri2Link.txt
    # 72682996 bases of 142573024 (50.979%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droGri2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droGri2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroGri2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    6m15.091s
    cat fb.droGri2.chainDm6Link.txt
    # 79673484 bases of 186090669 (42.814%) in intersection

###########################################################################
# LASTZ D. persimilis DroPer1 (DONE 2014-08-29 - Hiram)
    screen -S droPer1-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroPer1.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroPer1.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. persimilis
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. persimilis
SEQ2_DIR=/hive/data/genomes/droPer1/droPer1.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droPer1/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroPer1.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    49m9.697s
    cat fb.dm6.chainDroPer1Link.txt
    # 84187839 bases of 142573024 (59.049%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droPer1/bed/blastz.dm6.swap
    cd /hive/data/genomes/droPer1/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroPer1.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
XXX - running - Tue Sep  2 10:34:10 PDT 2014
    # real    13m28.190s
    cat fb.droPer1.chainDm6Link.txt
    # 92967575 bases of 175583556 (52.948%) in intersection


###########################################################################
# LASTZ D. virilis DroVir3 (DONE 2014-08-29 - Hiram)
    screen -S droVir3-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroVir3.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroVir3.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. virilis
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. virilis
SEQ2_DIR=/hive/data/genomes/droVir3/droVir3.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droVir3/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroVir3.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    53m38.503s
    cat fb.dm6.chainDroVir3Link.txt
    # 74048111 bases of 142573024 (51.937%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droVir3/bed/blastz.dm6.swap
    cd /hive/data/genomes/droVir3/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroVir3.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    6m56.701s
    cat fb.droVir3.chainDm6Link.txt
    # 82924532 bases of 189205863 (43.828%) in intersection

###########################################################################
# LASTZ T. castaneum TriCas2 (DONE 2014-08-29 - Hiram)
    screen -S triCas2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzTriCas2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzTriCas2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. T. castaneum
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - T. castaneum
SEQ2_DIR=/hive/data/genomes/triCas2/triCas2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/triCas2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzTriCas2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    43m49.065s
    cat fb.dm6.chainTriCas2Link.txt
    # 20091664 bases of 142573024 (14.092%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/triCas2/bed/blastz.dm6.swap
    cd /hive/data/genomes/triCas2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzTriCas2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    1m48.420s
    cat fb.triCas2.chainDm6Link.txt
    # 22441942 bases of 151549969 (14.808%) in intersection

###########################################################################
# LASTZ A. gambiae AnoGam1 (DONE 2014-08-29 - Hiram)
    screen -S anoGam1-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzAnoGam1.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzAnoGam1.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. sechellia
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - A. gambiae
SEQ2_DIR=/hive/data/genomes/anoGam1/anoGam1.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/anoGam1/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzAnoGam1.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    85m43.807s
    cat fb.dm6.chainAnoGam1Link.txt
    # 20604473 bases of 142573024 (14.452%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/anoGam1/bed/blastz.dm6.swap
    cd /hive/data/genomes/anoGam1/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzAnoGam1.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    2m1.764s
    cat fb.anoGam1.chainDm6Link.txt
    # 22154872 bases of 278268413 (7.962%) in intersection

###########################################################################
# LASTZ D. pseudoobscura DroPse3 (DONE 2014-08-29 - Hiram)
    screen -S droPse3-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroPse3.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroPse3.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. pseudoobscura
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. pseudoobscura
SEQ2_DIR=/hive/data/genomes/droPse3/droPse3.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droPse3/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroPse3.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    54m34.163s
    cat fb.dm6.chainDroPse3Link.txt
    # 85310450 bases of 142573024 (59.836%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droPse3/bed/blastz.dm6.swap
    cd /hive/data/genomes/droPse3/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroPse3.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    6m27.317s
    cat fb.droPse3.chainDm6Link.txt
    # 89188686 bases of 149047912 (59.839%) in intersection

###########################################################################
# LASTZ D. willistoni DroWil2 (DONE 2014-08-29 - Hiram)
    screen -S droWil2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroWil2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroWil2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. willistoni
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. willistoni
SEQ2_DIR=/hive/data/genomes/droWil2/droWil2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droWil2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroWil2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    12m46.450s
    cat fb.dm6.chainDroWil2Link.txt
    # 73328691 bases of 142573024 (51.432%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droWil2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droWil2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroWil2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    7m21.824s
    cat fb.droWil2.chainDm6Link.txt
    # 90409687 bases of 223610028 (40.432%) in intersection

###########################################################################
# LASTZ D. yakuba DroYak3 (DONE 2014-08-29 - Hiram)
    screen -S droYak3-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroYak3.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroYak3.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. yakuba
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. yakuba
SEQ2_DIR=/hive/data/genomes/droYak3/droYak3.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droYak3/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroYak3.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    68m39.923s
    cat fb.dm6.chainDroYak3Link.txt
    # 114859096 bases of 142573024 (80.562%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droYak3/bed/blastz.dm6.swap
    cd /hive/data/genomes/droYak3/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroYak3.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    8m13.655s
    cat fb.droYak3.chainDm6Link.txt
    # 131647225 bases of 162598019 (80.965%) in intersection

###########################################################################
# LASTZ A. mellifera ApiMel4 (DONE 2014-08-29 - Hiram)
    screen -S apiMel4-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzApiMel4.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzApiMel4.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. A. mellifera
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - A. mellifera
SEQ2_DIR=/hive/data/genomes/apiMel4/apiMel4.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/apiMel4/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzApiMel4.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    42m58.632s
    cat fb.dm6.chainApiMel4Link.txt
    # 11667011 bases of 142573024 (8.183%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/apiMel4/bed/blastz.dm6.swap
    cd /hive/data/genomes/apiMel4/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzApiMel4.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    1m19.091s
    cat fb.apiMel4.chainDm6Link.txt
    # 12280818 bases of 229123650 (5.360%) in intersection

###########################################################################
# LASTZ D. mojavensis DroMoj3 (DONE 2014-08-29 - Hiram)
    screen -S droMoj3-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroMoj3.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroMoj3.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. mojavensis
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. mojavensis
SEQ2_DIR=/hive/data/genomes/droMoj3/droMoj3.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droMoj3/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroMoj3.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    76m3.636s
    cat fb.dm6.chainDroMoj3Link.txt
    # 71474162 bases of 142573024 (50.132%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droMoj3/bed/blastz.dm6.swap
    cd /hive/data/genomes/droMoj3/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroMoj3.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    5m40.109s
    cat fb.droMoj3.chainDm6Link.txt
    # 74578701 bases of 180207831 (41.385%) in intersection

###########################################################################
# LASTZ D. pseudoobscura DP4 (Done 2014-08-29 - Hiram)
    screen -S dp4-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDP4.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDP4.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. pseudoobscura
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. pseudoobscura
SEQ2_DIR=/hive/data/genomes/dp4/dp4.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/dp4/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDP4.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    46m17.831s
    cat fb.dm6.chainDp4Link.txt
    # 85549372 bases of 142573024 (60.004%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/dp4/bed/blastz.dm6.swap
    cd /hive/data/genomes/dp4/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDP4.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    6m45.065s
    cat fb.dp4.chainDm6Link.txt
    # 88406867 bases of 146066673 (60.525%) in intersection

###########################################################################
# LASTZ D. albomicans DroAlb1 (DONE 2014-08-29 - Hiram)
    screen -S droAlb1-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroAlb1.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroAlb1.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. albomicans
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. albomicans
SEQ2_DIR=/hive/data/genomes/droAlb1/droAlb1.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droAlb1/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroAlb1.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << this line keeps emacs coloring happy
    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    86m58.011s
    cat fb.dm6.chainDroAlb1Link.txt
    # 63507363 bases of 142573024 (44.544%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droAlb1/bed/blastz.dm6.swap
    cd /hive/data/genomes/droAlb1/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroAlb1.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    7m39.524s
    cat fb.droAlb1.chainDm6Link.txt
    # 82594337 bases of 216120500 (38.217%) in intersection

###########################################################################
# LASTZ D. biarmipes DroBia2 (DONE 2014-08-29 - Hiram)
    screen -S droBia2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroBia2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroBia2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. biarmipes
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. biarmipes
SEQ2_DIR=/hive/data/genomes/droBia2/droBia2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droBia2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroBia2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    67m19.563s
    cat fb.dm6.chainDroBia2Link.txt
    # 106989297 bases of 142573024 (75.042%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droBia2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droBia2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroBia2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    7m41.031s
    cat fb.droBia2.chainDm6Link.txt
    # 113609151 bases of 168601808 (67.383%) in intersection

###########################################################################
# LASTZ D. bipectinata DroBip2 (DONE 2014-08-29 - Hiram)
    screen -S droBip2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroBip2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroBip2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. bipectinata
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. bipectinata
SEQ2_DIR=/hive/data/genomes/droBip2/droBip2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droBip2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroBip2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    72m58.502s

    cat fb.dm6.chainDroBip2Link.txt
    # 93905122 bases of 142573024 (65.865%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droBip2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droBip2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroBip2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    6m57.737s
    cat fb.droBip2.chainDm6Link.txt
    # 100268467 bases of 166411051 (60.253%) in intersection

###########################################################################
# LASTZ D. elegans DroEle2 (DONE 2014-08-29 - Hiram)
    screen -S droEle2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroEle2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroEle2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. elegans
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. elegans
SEQ2_DIR=/hive/data/genomes/droEle2/droEle2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droEle2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroEle2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    52m32.697s
    cat fb.dm6.chainDroEle2Link.txt
    # 107563805 bases of 142573024 (75.445%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droEle2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droEle2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroEle2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    7m37.855s
    cat fb.droEle2.chainDm6Link.txt
    # 115222391 bases of 170533638 (67.566%) in intersection

###########################################################################
# LASTZ D. eugracilis DroEug2 (DONE  2014-08-29 - Hiram)
    screen -S droEug2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroEug2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroEug2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. eugracilis
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. eugracilis
SEQ2_DIR=/hive/data/genomes/droEug2/droEug2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droEug2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroEug2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    81m4.137s
    cat fb.dm6.chainDroEug2Link.txt
    # 107307060 bases of 142573024 (75.265%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droEug2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droEug2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroEug2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    7m6.555s
    cat fb.droEug2.chainDm6Link.txt
    # 114576241 bases of 156328338 (73.292%) in intersection

###########################################################################
# LASTZ D. ficusphila DroFic2 (DONE 2014-08-29 - Hiram)
    screen -S droFic2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroFic2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroFic2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. ficusphila
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. ficusphila
SEQ2_DIR=/hive/data/genomes/droFic2/droFic2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droFic2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroFic2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    62m0.114s
    cat fb.dm6.chainDroFic2Link.txt
    # 106559757 bases of 142573024 (74.740%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droFic2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droFic2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroFic2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    6m54.593s

    cat fb.droFic2.chainDm6Link.txt
    # 112386864 bases of 151050603 (74.403%) in intersection

###########################################################################
# LASTZ D. kikkawai DroKik2 (DONE 2014-08-29 - Hiram)
    screen -S droKik2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroKik2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroKik2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. kikkawai
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. kikkawai
SEQ2_DIR=/hive/data/genomes/droKik2/droKik2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droKik2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroKik2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    68m49.238s
    cat fb.dm6.chainDroKik2Link.txt
    # 100642052 bases of 142573024 (70.590%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droKik2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droKik2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroKik2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    7m5.278s
    cat fb.droKik2.chainDm6Link.txt
    # 105765944 bases of 163450645 (64.708%) in intersection

###########################################################################
# LASTZ D. miranda DroMir2 (DONE 2014-08-29 - Hiram)
    screen -S droMir2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroMir2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroMir2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. miranda
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. miranda
SEQ2_DIR=/hive/data/genomes/droMir2/droMir2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droMir2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroMir2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    46m36.289s
    cat fb.dm6.chainDroMir2Link.txt
    # 84557634 bases of 142573024 (59.308%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droMir2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droMir2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroMir2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
XXX - running - Tue Sep  2 10:00:55 PDT 2014
    # real    real    4m55.434s

    cat fb.droMir2.chainDm6Link.txt
    # 84386358 bases of 132586288 (63.646%) in intersection

###########################################################################
# LASTZ D. suzukii DroSuz1 (DONE 2014-08-29 - Hiram)
    screen -S droSuz1-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroSuz1.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroSuz1.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. suzukii
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. suzukii
SEQ2_DIR=/hive/data/genomes/droSuz1/droSuz1.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droSuz1/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroSuz1.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    69m12.803s
    cat fb.dm6.chainDroSuz1Link.txt
    # 106346119 bases of 142573024 (74.591%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droSuz1/bed/blastz.dm6.swap
    cd /hive/data/genomes/droSuz1/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroSuz1.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    9m7.373s
    cat fb.droSuz1.chainDm6Link.txt
    # 129874262 bases of 202303443 (64.198%) in intersection

###########################################################################
# LASTZ D. rhopaloa DroRho2 (DONE 2014-08-29 - Hiram)
    screen -S droRho2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroRho2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroRho2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. rhopaloa
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. rhopaloa
SEQ2_DIR=/hive/data/genomes/droRho2/droRho2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droRho2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroRho2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real    79m31.589s
    cat fb.dm6.chainDroRho2Link.txt
    # 106844545 bases of 142573024 (74.940%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droRho2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droRho2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroRho2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real  10m15.734s
    cat fb.droRho2.chainDm6Link.txt
    # 126832194 bases of 193889799 (65.415%) in intersection

###########################################################################
# LASTZ D. takahashii DroTak2 (DONE 2014-08-29 - Hiram)
    screen -S droTak2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzDroTak2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzDroTak2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. D. takahashii
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - D. takahashii
SEQ2_DIR=/hive/data/genomes/droTak2/droTak2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/droTak2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzDroTak2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # real     66m20.654s
    cat fb.dm6.chainDroTak2Link.txt
    # 107653248 bases of 142573024 (75.507%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/droTak2/bed/blastz.dm6.swap
    cd /hive/data/genomes/droTak2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzDroTak2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    7m15.787s
    cat fb.droTak2.chainDm6Link.txt
    # 114989522 bases of 181031891 (63.519%) in intersection

###########################################################################
# LASTZ M. domestica MusDom2 (DONE 2014-08-29 - Hiram)
    screen -S musDom2-dm6
    mkdir /hive/data/genomes/dm6/bed/lastzMusDom2.2014-08-29
    cd /hive/data/genomes/dm6/bed/lastzMusDom2.2014-08-29

    cat << '_EOF_' > DEF
# D. melanogaster vs. M. domestica
BLASTZ=/cluster/bin/penn/lastz-distrib-1.03.52/bin/lastz
BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=4000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET - D. melanogaster
SEQ1_DIR=/hive/data/genomes/dm6/dm6.2bit
SEQ1_CHUNK=5000000
SEQ1_LAP=10000
SEQ1_LEN=/hive/data/genomes/dm6/chrom.sizes

# QUERY - M. domestica
SEQ2_DIR=/hive/data/genomes/musDom2/musDom2.2bit
SEQ2_CHUNK=5000000
SEQ2_LAP=10000
SEQ2_LEN=/hive/data/genomes/musDom2/chrom.sizes

BASE=/hive/data/genomes/dm6/bed/lastzMusDom2.2014-08-29
TMPDIR=/dev/shm
'_EOF_'
    # << happy emacs

    time doBlastzChainNet.pl `pwd`/DEF \
        -syntenicNet -fileServer=hgwdev \
        -chainMinScore=3000  -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > do.log 2>&1
    # Elapsed time: 81m30s
    cat fb.dm6.chainMusDom2Link.txt
    # 27485718 bases of 142573024 (19.278%) in intersection

    #   running the swap
    mkdir /hive/data/genomes/musDom2/bed/blastz.dm6.swap
    cd /hive/data/genomes/musDom2/bed/blastz.dm6.swap
    time nice -n +19 doBlastzChainNet.pl -verbose=2 \
        /hive/data/genomes/dm6/bed/lastzMusDom2.2014-08-29/DEF \
        -swap -syntenicNet -chainMinScore=3000 -chainLinearGap=loose \
        -workhorse=hgwdev -smallClusterHub=ku -bigClusterHub=ku > swap.log 2>&1
    # real    3m35.469s
    cat fb.musDom2.chainDm6Link.txt
    # 33622643 bases of 691751600 (4.861%) in intersection

#########################################################################
## 27-Way Multiz (DONE - 2014-09-05 - Hiram)
    ssh hgwdev
    mkdir /hive/data/genomes/dm6/bed/multiz27way
    cd /hive/data/genomes/dm6/bed/multiz27way

    # worked up a phylo tree with the help of
    # http://phylot.biobyte.de/
    # http://itol.embl.de/
    # and editor: http://treegraph.bioinfweb.info/

    cp -p ~/kent/src/hg/utils/phyloTrees/dm6.27way.nh ./


    #	what that looks like:
    ~/kent/src/hg/utils/phyloTrees/asciiTree.pl dm6.27way.nh
(((((((((((((((((dm6:0.1,
                (droSim1:0.1,
                droSec1:0.1):0.1):0.1,
               (droYak3:0.1,
               droEre2:0.1):0.1):0.1,
              (droBia2:0.1,
              droSuz1:0.1):0.1):0.1,
             (droAna3:0.1,
             droBip2:0.1):0.1):0.1,
            droEug2:0.1):0.1,
           droEle2:0.1):0.1,
          droKik2:0.1):0.1,
         droTak2:0.1):0.1,
        droRho2:0.1):0.1,
       droFic2:0.1):0.1,
      ((droPse3:0.1,
       droPer1:0.1):0.1,
      droMir2:0.1):0.1):0.1,
     droWil2:0.1):0.1,
    (((droVir3:0.1,
      droMoj3:0.1):0.1,
     droAlb1:0.1):0.1,
    droGri2:0.1):0.1):0.1,
   musDom2:0.1):0.1,
  anoGam1:0.1):0.1,
 apiMel4:0.1):0.1,
triCas2:0.1);

    # extract species list from that .nh file
    sed 's/[a-z][a-z]*_//g; s/:[0-9\.][0-9\.]*//g; s/;//; /^ *$/d' \
        dm6.27way.nh | xargs echo | sed 's/ //g; s/,/ /g' \
        | sed 's/[()]//g; s/,/ /g' | tr '[ ]' '[\n]' > species.list.txt

    # construct db to common name translation list:
    cat species.list.txt | while read DB
do
hgsql -N -e "select name,organism from dbDb where name=\"${DB}\";" hgcentraltest
done | sed -e "s/\t/->/; s/ /_/g;" | sed -e 's/$/;/' | sed -e 's/\./_/g' \
        > db.to.name.txt
    # construct db to scientific name translation list:
    cat species.list.txt | while read DB
do
hgsql -N -e "select name,scientificName from dbDb where name=\"${DB}\";" hgcentraltest
done | sed -e "s/\t/->/; s/ /_/g;" | sed -e 's/$/;/' | sed -e 's/\./_/g' \
     | sed -e 's/pseudoobscura_pseudoobscura/pseudoobscura/;' \
        > db.to.sciName.txt

    # construct a common name .nh file:
    /cluster/bin/phast/tree_doctor --rename \
    "`cat db.to.name.txt`" dm6.27way.nh | sed -e 's/00*)/)/g; s/00*,/,/g' \
       | $HOME/kent/src/hg/utils/phyloTrees/asciiTree.pl /dev/stdin \
         > dm6.27way.commonNames.nh

    # construct a scientific name .nh file:
    /cluster/bin/phast/tree_doctor --rename \
    "`cat db.to.sciName.txt`" dm6.27way.nh | sed -e 's/00*)/)/g; s/00*,/,/g' \
       | $HOME/kent/src/hg/utils/phyloTrees/asciiTree.pl /dev/stdin \
         > dm6.27way.scientificNames.nh
    # construct a scientific name .nh file:

    cat dm6.27way.scientificNames.nh
(((((((((((((((((Drosophila_melanogaster:0.1,
                (Drosophila_simulans:0.1,
                Drosophila_sechellia:0.1):0.1):0.1,
               (Drosophila_yakuba:0.1,
               Drosophila_erecta:0.1):0.1):0.1,
              (Drosophila_biarmipes:0.1,
              Drosophila_suzukii:0.1):0.1):0.1,
             (Drosophila_ananassae:0.1,
             Drosophila_bipectinata:0.1):0.1):0.1,
            Drosophila_eugracilis:0.1):0.1,
           Drosophila_elegans:0.1):0.1,
          Drosophila_kikkawai:0.1):0.1,
         Drosophila_takahashii:0.1):0.1,
        Drosophila_rhopaloa:0.1):0.1,
       Drosophila_ficusphila:0.1):0.1,
      ((Drosophila_pseudoobscura:0.1,
       Drosophila_persimilis:0.1):0.1,
      Drosophila_miranda:0.1):0.1):0.1,
     Drosophila_willistoni:0.1):0.1,
    (((Drosophila_virilis:0.1,
      Drosophila_mojavensis:0.1):0.1,
     Drosophila_albomicans:0.1):0.1,
    Drosophila_grimshawi:0.1):0.1):0.1,
   Musca_domestica:0.1):0.1,
  Anopheles_gambiae:0.1):0.1,
 Apis_mellifera:0.1):0.1,
Tribolium_castaneum:0.1);

    #	Use this specification in the phyloGif tool:
    #	http://genome.ucsc.edu/cgi-bin/phyloGif
    #	to obtain a png image for src/hg/htdocs/images/phylo/dm6_27way.png

    /cluster/bin/phast/all_dists dm6.27way.nh | grep dm6 \
        | sed -e "s/dm6.//" | sort -k2n > 27way.distances.txt
    #	Use this output to create the table below
    head 27way.distances.txt
droSec1 0.300000
droSim1 0.300000
droEre2 0.400000
droYak3 0.400000
droBia2 0.500000
droSuz1 0.500000
droAna3 0.600000
droBip2 0.600000
droEug2 0.600000
droEle2 0.700000

    cat << '_EOF_' > sizeStats.pl
#!/usr/bin/env perl

use strict;
use warnings;

open (FH, "<27way.distances.txt") or
        die "can not read 27way.distances.txt";

my $count = 0;
while (my $line = <FH>) {
    chomp $line;
    my ($D, $dist) = split('\s+', $line);
    my $chain = "chain" . ucfirst($D);
    my $B="/hive/data/genomes/dm6/bed/lastz.$D/fb.dm6." .
        $chain . "Link.txt";
    my $chainLinkMeasure =
        `awk '{print \$5}' ${B} 2> /dev/null | sed -e "s/(//; s/)//"`;
    chomp $chainLinkMeasure;
    $chainLinkMeasure = 0.0 if (length($chainLinkMeasure) < 1);
    $chainLinkMeasure =~ s/\%//;
    my $swapFile="/hive/data/genomes/${D}/bed/lastz.dm6/fb.${D}.chainDm6Link.txt";
    my $swapMeasure = "N/A";
    if ( -s $swapFile ) {
	$swapMeasure =
	    `awk '{print \$5}' ${swapFile} 2> /dev/null | sed -e "s/(//; s/)//"`;
	chomp $swapMeasure;
	$swapMeasure = 0.0 if (length($swapMeasure) < 1);
	$swapMeasure =~ s/\%//;
    }
    my $orgName=
    `hgsql -N -e "select organism from dbDb where name='$D';" hgcentraltest`;
    chomp $orgName;
    if (length($orgName) < 1) {
        $orgName="N/A";
    }
    ++$count;
    printf "# %02d  %.4f (%% %06.3f) (%% %06.3f) - %s %s\n", $count, $dist,
        $chainLinkMeasure, $swapMeasure, $orgName, $D;
}
close (FH);
'_EOF_'
    # << happy emacs
    chmod +x ./sizeStats.pl
    ./sizeStats.pl
#

#	If you can fill in all the numbers in this table, you are ready for
#	the multiple alignment procedure

#       featureBits chainLink measures
#               chainLink
#  N distance  on dm6  on other     other species
# 01  0.3000 (% 82.561) (% 81.572) - D. sechellia droSec1
# 02  0.3000 (% 80.042) (% 89.329) - D. simulans droSim1
# 03  0.4000 (% 80.023) (% 84.386) - D. erecta droEre2
# 04  0.4000 (% 80.562) (% 80.965) - D. yakuba droYak3
# 05  0.5000 (% 75.042) (% 67.383) - D. biarmipes droBia2
# 06  0.5000 (% 74.591) (% 64.198) - D. suzukii droSuz1
# 07  0.6000 (% 67.282) (% 58.760) - D. ananassae droAna3
# 08  0.6000 (% 65.865) (% 60.253) - D. bipectinata droBip2
# 09  0.6000 (% 75.265) (% 73.292) - D. eugracilis droEug2
# 10  0.7000 (% 75.445) (% 67.566) - D. elegans droEle2
# 11  0.8000 (% 70.590) (% 64.708) - D. kikkawai droKik2
# 12  0.9000 (% 75.507) (% 63.519) - D. takahashii droTak2
# 13  1.0000 (% 74.940) (% 65.415) - D. rhopaloa droRho2
# 14  1.1000 (% 74.740) (% 74.403) - D. ficusphila droFic2
# 15  1.3000 (% 59.308) (% 63.646) - D. miranda droMir2
# 16  1.3000 (% 51.432) (% 40.432) - D. willistoni droWil2
# 17  1.4000 (% 59.049) (% 52.949) - D. persimilis droPer1
# 18  1.4000 (% 59.836) (% 59.839) - D. pseudoobscura droPse3
# 19  1.5000 (% 50.979) (% 42.814) - D. grimshawi droGri2
# 20  1.5000 (% 19.278) (% 04.861) - M. domestica musDom2
# 21  1.6000 (% 14.452) (% 07.962) - A. gambiae anoGam1
# 22  1.6000 (% 44.544) (% 38.217) - D. albomicans droAlb1
# 23  1.7000 (% 08.183) (% 05.360) - A. mellifera apiMel4
# 24  1.7000 (% 50.132) (% 41.385) - D. mojavensis droMoj3
# 25  1.7000 (% 51.937) (% 43.828) - D. virilis droVir3
# 26  1.8000 (% 14.092) (% 14.808) - T. castaneum triCas2

# None of this concern for distances matters in building the first step, the
# maf files.

    # create species list and stripped down tree for autoMZ
    sed 's/[a-z][a-z]*_//g; s/:[0-9\.][0-9\.]*//g; s/;//; /^ *$/d' \
	dm6.27way.nh | xargs echo | sed 's/ //g; s/,/ /g' > tree.nh

    sed 's/[()]//g; s/,/ /g' tree.nh > species.list
# dm6 droSim1 droSec1 droYak3 droEre2 droBia2 droSuz1 droAna3 droBip2 droEug2 
# droEle2 droKik2 droTak2 droRho2 droFic2 droPse3 droPer1 droMir2 droWil2 
# droVir3 droMoj3 droAlb1 droGri2 musDom2 anoGam1 apiMel4 triCas2

    #	bash shell syntax here ...
    cd /hive/data/genomes/dm6/bed/multiz27way
    export H=/hive/data/genomes/dm6/bed
    mkdir mafLinks
    # want syntenic net for all the Drosophilas
    for G in droAlb1 droAna3 droBia2 droBip2 droEle2 droEre2 droEug2 droFic2 droGri2 droKik2 droMir2 droMoj3 droPer1 droPse3 droRho2 droSec1 droSim1 droSuz1 droTak2 droVir3 droWil2 droYak3
    do
      mkdir mafLinks/$G
      echo ln -s ${H}/lastz.$G/axtChain/dm6.${G}.synNet.maf.gz ./mafLinks/$G
      ln -s ${H}/lastz.$G/axtChain/dm6.${G}.synNet.maf.gz ./mafLinks/$G
    done

    # and basic maf net for the others:
    for G in anoGam1 apiMel4 musDom2 triCas2
do
      mkdir mafLinks/$G
      echo ln -s ${H}/lastz.$G/mafNet/dm6.${G}.net.maf.gz ./mafLinks/$G
      ln -s ${H}/lastz.$G/mafNet/dm6.${G}.net.maf.gz ./mafLinks/$G
done

    # verify the symLinks are good:
    ls -ogrtL mafLinks/*/*
# -rw-rw-r-- 1 57989657 Aug 29 11:52 mafLinks/droAna3/dm6.droAna3.synNet.maf.gz
# -rw-rw-r-- 1 66653928 Aug 29 13:31 mafLinks/droEre2/dm6.droEre2.synNet.maf.gz
# -rw-rw-r-- 1 55414479 Aug 29 13:48 mafLinks/droSim1/dm6.droSim1.synNet.maf.gz
# -rw-rw-r-- 1 64261526 Aug 29 13:55 mafLinks/droSec1/dm6.droSec1.synNet.maf.gz
# -rw-rw-r-- 1 43326252 Aug 29 13:58 mafLinks/droGri2/dm6.droGri2.synNet.maf.gz
# -rw-rw-r-- 1 14470342 Aug 29 14:03 mafLinks/triCas2/dm6.triCas2.net.maf.gz
# -rw-rw-r-- 1 53914019 Aug 29 14:06 mafLinks/droPer1/dm6.droPer1.synNet.maf.gz
# -rw-rw-r-- 1  8871501 Aug 29 14:09 mafLinks/apiMel4/dm6.apiMel4.net.maf.gz
# -rw-rw-r-- 1 44299779 Aug 29 14:12 mafLinks/droVir3/dm6.droVir3.synNet.maf.gz
# -rw-rw-r-- 1 56305568 Aug 29 14:19 mafLinks/droPse3/dm6.droPse3.synNet.maf.gz
# -rw-rw-r-- 1 58119972 Aug 29 14:31 mafLinks/droMir2/dm6.droMir2.synNet.maf.gz
# -rw-rw-r-- 1 68523213 Aug 29 14:31 mafLinks/droEle2/dm6.droEle2.synNet.maf.gz
# -rw-rw-r-- 1 68100446 Aug 29 14:35 mafLinks/droYak3/dm6.droYak3.synNet.maf.gz
# -rw-rw-r-- 1 64321608 Aug 29 14:43 mafLinks/droBia2/dm6.droBia2.synNet.maf.gz
# -rw-rw-r-- 1 44761222 Aug 29 14:43 mafLinks/droWil2/dm6.droWil2.synNet.maf.gz
# -rw-rw-r-- 1 68869400 Aug 29 14:44 mafLinks/droFic2/dm6.droFic2.synNet.maf.gz
# -rw-rw-r-- 1 42864649 Aug 29 14:45 mafLinks/droMoj3/dm6.droMoj3.synNet.maf.gz
# -rw-rw-r-- 1 14470901 Aug 29 14:47 mafLinks/anoGam1/dm6.anoGam1.net.maf.gz
# -rw-rw-r-- 1 61398493 Aug 29 14:51 mafLinks/droBip2/dm6.droBip2.synNet.maf.gz
# -rw-rw-r-- 1 66734812 Aug 29 14:52 mafLinks/droKik2/dm6.droKik2.synNet.maf.gz
# -rw-rw-r-- 1 67398540 Aug 29 14:54 mafLinks/droTak2/dm6.droTak2.synNet.maf.gz
# -rw-rw-r-- 1 60781324 Aug 29 14:54 mafLinks/droSuz1/dm6.droSuz1.synNet.maf.gz
# -rw-rw-r-- 1 28941891 Aug 29 15:01 mafLinks/droAlb1/dm6.droAlb1.synNet.maf.gz
# -rw-rw-r-- 1 69660184 Aug 29 15:02 mafLinks/droEug2/dm6.droEug2.synNet.maf.gz
# -rw-rw-r-- 1 61713626 Aug 29 15:06 mafLinks/droRho2/dm6.droRho2.synNet.maf.gz
# -rw-rw-r-- 1 19994083 Aug 29 15:08 mafLinks/musDom2/dm6.musDom2.net.maf.gz

#-rw-rw-r-- 1  709500062 Jan 25 12:15 mafLinks/mm10/dm6.mm10.synNet.maf.gz
#-rw-rw-r-- 1 1089643630 Jan 27 19:15 mafLinks/canFam3/dm6.canFam3.synNet.maf.gz
#-rw-rw-r-- 1 1277455681 Jan 27 21:52 mafLinks/rheMac3/dm6.rheMac3.synNet.maf.gz
#-rw-rw-r-- 1  687500679 Mar  1 12:27 mafLinks/rn5/dm6.rn5.synNet.maf.gz
#-rw-rw-r-- 1 1463969868 May 27 11:41 mafLinks/panTro4/dm6.panTro4.synNet.maf.gz
#-rw-rw-r-- 1  323347908 May 29 12:38 mafLinks/monDom5/dm6.monDom5.net.maf.gz

    # split the maf files into a set of hashed named files
    # this hash named split keeps the same chr/contig names in the same
    # named hash file.
    mkdir /hive/data/genomes/dm6/bed/multiz27way/mafSplit
    cd /hive/data/genomes/dm6/bed/multiz27way/mafSplit
    for D in `sed -e "s/dm6 //" ../species.list`
do
    echo "${D}"
    mkdir $D
    cd $D
    echo "mafSplit -byTarget -useHashedName=8 /dev/null . ../../mafLinks/${D}/*.maf.gz"
    mafSplit -byTarget -useHashedName=8 /dev/null . \
	../../mafLinks/${D}/*.maf.gz
    cd ..
done

    # construct a list of all possible maf file names.
    # they do not all exist in each of the species directories
    find . -type f | wc -l
    # 678
    find . -type f | grep ".maf$" | xargs -L 1 basename | sort -u > maf.list
    wc -l maf.list
    # 161 maf.list

    mkdir /hive/data/genomes/dm6/bed/multiz27way/splitRun
    cd /hive/data/genomes/dm6/bed/multiz27way/splitRun
    mkdir maf run
    cd run
    mkdir penn
    cp -p /cluster/bin/penn/multiz.2009-01-21_patched/multiz penn
    cp -p /cluster/bin/penn/multiz.2009-01-21_patched/maf_project penn
    cp -p /cluster/bin/penn/multiz.2009-01-21_patched/autoMZ penn

    #	set the db and pairs directories here
    cat > autoMultiz.csh << '_EOF_'
#!/bin/csh -ef
set db = dm6
set c = $1
set result = $2
set run = `/bin/pwd`
set tmp = /dev/shm/$db/multiz.$c
set pairs = /hive/data/genomes/dm6/bed/multiz27way/mafSplit
/bin/rm -fr $tmp
/bin/mkdir -p $tmp
/bin/cp -p ../../tree.nh ../../species.list $tmp
pushd $tmp > /dev/null
foreach s (`/bin/sed -e "s/$db //" species.list`)
    set in = $pairs/$s/$c
    set out = $db.$s.sing.maf
    if (-e $in.gz) then
        /bin/zcat $in.gz > $out
        if (! -s $out) then
            echo "##maf version=1 scoring=autoMZ" > $out
        endif
    else if (-e $in) then
        /bin/ln -s $in $out
    else
        echo "##maf version=1 scoring=autoMZ" > $out
    endif
end
set path = ($run/penn $path); rehash
$run/penn/autoMZ + T=$tmp E=$db "`cat tree.nh`" $db.*.sing.maf $c \
        > /dev/null
popd > /dev/null
/bin/rm -f $result
/bin/cp -p $tmp/$c $result
/bin/rm -fr $tmp
'_EOF_'
# << happy emacs
    chmod +x autoMultiz.csh

    cat  << '_EOF_' > template
#LOOP
./autoMultiz.csh $(file1) {check out line+ /hive/data/genomes/dm6/bed/multiz27way/splitRun/maf/$(root1).maf}
#ENDLOOP
'_EOF_'
# << happy emacs

    ln -s ../../mafSplit/maf.list maf.list
    ssh ku
    cd /hive/data/genomes/dm6/bed/multiz27way/splitRun/run
    gensub2 maf.list single template stdout > jobList
    para -ram=8g create jobList
# Completed: 161 of 161 jobs
# CPU time in finished jobs:     172027s    2867.12m    47.79h    1.99d  0.005 y
# IO & Wait Time:                  1065s      17.75m     0.30h    0.01d  0.000 y
# Average job time:                1075s      17.92m     0.30h    0.01d
# Longest finished job:           42777s     712.95m    11.88h    0.50d
# Submission to last job:         42793s     713.22m    11.89h    0.50d

    # combine into one file  (the 1>&2 redirect sends the echo to stderr)
    cd /hive/data/genomes/dm6/bed/multiz27way
    head -1 splitRun/maf/053.maf > multiz27way.maf
    for F in splitRun/maf/*.maf
do
    echo "${F}" 1>&2
    egrep -v "^#" ${F}
done >> multiz27way.maf
    tail -1 splitRun/maf/053.maf >> multiz27way.maf
# -rw-rw-r--  1 5808772759 Sep  5 15:14 multiz27way.maf

    # Load into database
    ssh hgwdev
    cd /hive/data/genomes/dm6/bed/multiz27way
    mkdir /gbdb/dm6/multiz27way
    ln -s `pwd`/multiz27way.maf /gbdb/dm6/multiz27way
    cd /dev/shm
    time hgLoadMaf dm6 multiz27way
    # Loaded 2110160 mafs in 1 files from /gbdb/dm6/multiz27way
    # real    5m42.300s

    time hgLoadMafSummary -verbose=2 -minSize=30000 \
	-mergeGap=1500 -maxSize=200000 dm6 multiz27waySummary \
	/gbdb/dm6/multiz27way/multiz27way.maf
    # Created 157893 summary blocks from 34026658 components and 2110160 mafs from /gbdb/dm6/multiz27way/multiz27way.maf
    # real    2m44.856s


    wc -l multiz27way*.tab
    #  2110160 multiz27way.tab
    #   157893 multiz27waySummary.tab
    #  2268053 total

-rw-rw-r-- 1 102915136 Sep  5 15:20 multiz27way.tab
-rw-rw-r-- 1   7215723 Sep  5 15:35 multiz27waySummary.tab

    rm multiz27way*.tab

##############################################################################
# multiz27way MAF FRAMES (DONE - 2014-09-11 - Hiram)
    ssh hgwdev
    mkdir /hive/data/genomes/dm6/bed/multiz27way/frames
    cd /hive/data/genomes/dm6/bed/multiz27way/frames
#   survey all the genomes to find out what kinds of gene tracks they have
    cat << '_EOF_' > showGenes.csh
#!/bin/csh -fe
foreach db (`cat ../species.list`)
    echo -n "${db}: "
    set tables = `hgsql $db -N -e "show tables like '%Gene%'"`
    foreach table ($tables)
        if ($table == "ensGene" || $table == "refGene" || \
           $table == "mgcGenes" || $table == "knownGene" || \
           $table == "xenoRefGene" ) then
           set count = `hgsql $db -N -e "select count(*) from $table"`
            echo -n "${table}: ${count}, "
        endif
    end
    set orgName = `hgsql hgcentraltest -N -e \
            "select scientificName from dbDb where name='$db'"`
    set orgId = `hgsql hg19 -N -e \
            "select id from organism where name='$orgName'"`
    if ($orgId == "") then
        echo "Mrnas: 0"
    else
        set count = `hgsql hg19 -N -e "select count(*) from gbCdnaInfo where organism=$orgId"`
        echo "Mrnas: ${count}"
    endif
end
'_EOF_'
    # << happy emacs
    chmod +x ./showGenes.csh
    time ./showGenes.csh

# dm6: refGene: 36039, xenoRefGene: 49470, Mrnas: 907097
# droSim1: xenoRefGene: 256763, Mrnas: 119083
# droSec1: xenoRefGene: 223223, Mrnas: 38274
# droYak3: Mrnas: 11950
# droEre2: Mrnas: 22704
# droBia2: Mrnas: 0
# droSuz1: Mrnas: 1
# droAna3: Mrnas: 23405
# droBip2: Mrnas: 3
# droEug2: Mrnas: 5
# droEle2: Mrnas: 1
# droKik2: Mrnas: 2
# droTak2: Mrnas: 1
# droRho2: Mrnas: 4
# droFic2: Mrnas: 1
# droPse3: Mrnas: 18
# droPer1: xenoRefGene: 221008, Mrnas: 34
# droMir2: Mrnas: 2
# droWil2: Mrnas: 26771
# droVir3: Mrnas: 22882
# droMoj3: Mrnas: 19869
# droAlb1: Mrnas: 1
# droGri2: Mrnas: 21278
# musDom2: Mrnas: 9396
# anoGam1: ensGene: 15802, xenoRefGene: 107609, Mrnas: 217467
# apiMel4: Mrnas: 199705
# triCas2: Mrnas: 65947

######################################################################
# construct downloads files and pushQ entry (DONE - 2014-10-14 - Hiram)
#   before starting downloads, the joinerCheck should be clean
#   after dm6 is added to all.joiner:
    joinerCheck -tableCoverage -database=dm6 all.joiner
    joinerCheck -keys -database=dm6 all.joiner

    cd /hive/data/genomes/dm6
    makeDownloads.pl -dbHost=hgwdev -workhorse=hgwdev dm6 \
	> downloads.log 2>&1
    # real    28m50.409s

    # examine the goldenPath/*/README.txt files to verify the text

    # ready for pushQ entry (DONE - 2014-10-14 - Hiram)
    mkdir /hive/data/genomes/dm6/pushQ
    cd /hive/data/genomes/dm6/pushQ
    makePushQSql.pl dm6 > dm6.sql 2> stderr.out
    # real    1m52.294s
    # some errors are legitimate and OK:
     head stderr.out
# WARNING: hgwdev does not have /gbdb/dm6/wib/gc5Base.wib
# WARNING: hgwdev does not have /gbdb/dm6/wib/quality.wib
# WARNING: hgwdev does not have /gbdb/dm6/bbi/qualityBw/quality.bw
# WARNING: dm6 does not have seq

    scp -p dm6.sql qateam@hgwbeta:/tmp
    ssh qateam@hgwbeta './bin/x86_64/hgsql qapushq < /tmp/dm6.sql'

##############################################################################
