var pt=React.PropTypes;var RegionSelect=React.createClass({displayName:"RegionSelect",mixins:[PathUpdate,ImmutableUpdate],propTypes:{regionSelect:pt.object.isRequired,db:pt.string},menuOptions:Immutable.fromJS([{label:"position or search term",value:"position"},{label:"genome",value:"genome"},{label:"defined regions",value:"userRegions"}]),changeRegions:function(){this.props.update(this.props.path.concat("changeRegions"))},clearRegions:function(){this.props.update(this.props.path.concat("clearRegions"))},render:function(){var props=this.props;var regionSelect=props.regionSelect;var userRegions=regionSelect.get("userRegions");var selected=regionSelect.get("hgi_range");var modeControls=null;if(selected==="userRegions"){modeControls=[React.createElement("span",{className:"smallText sectionItem"},userRegions.get("summary")),React.createElement("input",{type:"button",value:"change regions",onClick:this.changeRegions}),React.createElement("input",{type:"button",value:"clear",onClick:this.clearRegions})]}else if(selected!=="genome"){modeControls=React.createElement(PositionSearch,{positionInfo:regionSelect.get("positionInfo"),className:"sectionItem",db:props.db,path:props.path.concat("positionInfo"),update:props.update})}var spinner=null;if(regionSelect.get("loading")){spinner=React.createElement(Icon,{type:"spinner",className:"floatRight"})}return React.createElement("div",{className:"sectionRow"},React.createElement(LabeledSelect,{label:"region to annotate",className:"sectionItem",selected:selected,options:this.menuOptions,update:props.update,path:props.path.concat("hgi_range")}),spinner,modeControls,React.createElement(UserRegions,{settings:userRegions,update:props.update,path:props.path.concat("userRegions")}))}});var LabeledSelectRow=React.createClass({displayName:"LabeledSelectRow",mixins:[PathUpdate,ImmutableUpdate],propTypes:{descriptors:pt.object.isRequired},makeMenuFromDescriptor:function(descriptor,ix){if(!descriptor||descriptor.get("hide")){return null}else{var key="lsrMenu"+ix;return React.createElement(LabeledSelect,{label:descriptor.get("label"),selected:descriptor.get("selected"),options:descriptor.get("valLabels"),key:key,className:"sectionItem",update:this.props.update,path:this.props.path.concat(ix)})}},render:function(){var descriptors=this.props.descriptors;return React.createElement("div",{className:"sectionRow sectionItem"},descriptors.map(this.makeMenuFromDescriptor).toJS())}});function makeSchemaLink(schemaUrl){if(schemaUrl){return React.createElement("span",{className:"smallText sectionItem"},React.createElement("a",{href:schemaUrl,target:"ucscSchema",title:"Open table schema in new window"},"View table schema"))}else{return null}}var AddDataSource=React.createClass({displayName:"AddDataSource",mixins:[PathUpdate,ImmutableUpdate],propTypes:{addDsInfo:pt.object.isRequired},onAdd:function(){this.props.update(this.props.path.concat("addDataSource"))},onTrackHubs:function(){this.props.update(this.props.path.concat("trackHubs"))},onCustomTracks:function(){this.props.update(this.props.path.concat("customTracks"))},render:function(){var path=this.props.path||[];var addDsInfo=this.props.addDsInfo;if(!(addDsInfo&&addDsInfo.size)){return React.createElement(Icon,{type:"spinner"})}var schemaLink=makeSchemaLink(addDsInfo.get("schemaUrl"));return React.createElement("div",null,React.createElement("div",{className:"boldText sectionRow"},"Add Data Source"),React.createElement(LabeledSelectRow,{descriptors:addDsInfo.get("menus"),path:path.concat("addDsMenuSelect"),update:this.props.update}),schemaLink,React.createElement("input",{type:"button",value:"Add",disabled:addDsInfo.get("disabled"),onClick:this.onAdd}),React.createElement("br",null),React.createElement("div",{className:"sectionRow"},"get more data:",React.createElement("br",null),React.createElement("input",{type:"button",value:"track hubs",onClick:this.onTrackHubs}),React.createElement("input",{type:"button",value:"custom tracks",onClick:this.onCustomTracks})))}});var FieldSelect=React.createClass({displayName:"FieldSelect",mixins:[PathUpdate,ImmutableUpdate],propTypes:{fieldInfo:pt.object},makeCheckboxGrid:function(table,fields){return _.map(fields,function(checkedAndDesc,field){var path=this.props.path.concat(table,field,"checked");var checked=checkedAndDesc.checked;return React.createElement("tr",{key:table+"."+field+".row"},React.createElement("td",{key:table+"."+field+".cb"},React.createElement(CheckboxLabel,{checked:checked,path:path,update:this.props.update})),React.createElement("td",{key:table+"."+field+".label"},field),React.createElement("td",{key:table+"."+field+".desc",style:{paddingLeft:"0.5em"}},checkedAndDesc.desc))},this).concat(React.createElement("tr",null,React.createElement("td",null,React.createElement("br",null)),React.createElement("td",null)))},makeTableSections:function(){var fieldInfo=this.props.fieldInfo.toJS();return _.map(fieldInfo,function(info,table){return[React.createElement("tr",{key:table},React.createElement("td",{colSpan:3},React.createElement("span",{className:"boldText"},info.label),React.createElement(SetClearButtons,{path:this.props.path.concat(table),update:this.props.update}))),this.makeCheckboxGrid(table,info.fields)]},this)},onDone:function(){this.props.update(this.props.path.concat("remove"))},render:function(){if(this.props.fieldInfo){return React.createElement(Modal,{title:"Choose Fields",path:this.props.path,update:this.props.update},React.createElement("div",{style:{height:5}}),React.createElement("table",{style:{borderCollapse:"collapse"}},this.makeTableSections()),React.createElement("input",{type:"button",value:"Done",onClick:this.onDone}))}else{return null}}});var OutFileOptions=React.createClass({displayName:"OutFileOptions",mixins:[PathUpdate,ImmutableUpdate],propTypes:{options:pt.object,fieldInfo:pt.object,showLoadingImage:pt.bool,disableGetOutput:pt.bool,disableGetOutputMessage:pt.node},getDefaultProps:function(){return{showLoadingImage:false}},onChooseFields:function(){var path=this.props.path||[];this.props.update(path.concat("chooseFields"))},onGetOutput:function(){var path=this.props.path||[];this.props.update(path.concat("getOutput"))},render:function(){var doFile=this.props.options.get("doFile");var fileName=this.props.options.get("fileName");var doGzip=this.props.options.get("doGzip");var path=this.props.path||[];var fileInputDisplay=doFile?"inline-block":"none";if(this.props.disableGetOutput){return this.props.disableGetOutputMessage}return React.createElement("div",null,React.createElement("div",{className:"sectionRow"},React.createElement(CheckboxLabel,{checked:doFile,label:"Send output to file",className:"sectionItem",path:path.concat("doFile"),update:this.props.update}),React.createElement("div",{style:{display:fileInputDisplay}},React.createElement("span",{className:"sectionItem"},"name:"),React.createElement("span",{className:"sectionItem"},React.createElement(TextInput,{value:fileName,path:path.concat("fileName"),update:this.props.update,size:75})),React.createElement(CheckboxLabel,{checked:doGzip,label:"Compress with gzip (.gz)",className:"sectionItem",path:path.concat("doGzip"),update:this.props.update}))),React.createElement("div",{className:"sectionRow"},React.createElement("input",{type:"button",value:"Choose fields...",onClick:this.onChooseFields})),React.createElement(FieldSelect,{fieldInfo:this.props.fieldInfo,update:this.props.update,path:path.concat("fieldSelect")}),React.createElement("div",{className:"sectionRow"},React.createElement("br",null),React.createElement("input",{type:"button",value:"Get output",onClick:this.onGetOutput})),React.createElement(LoadingImage,{loading:this.props.showLoadingImage}))}});var QueryBuilder=React.createClass({displayName:"QueryBuilder",mixins:[PathUpdate,ImmutableUpdate],propTypes:{querySpec:pt.object,addDsInfo:pt.object,tableFields:pt.object,showLoadingImage:pt.bool},renderDataSource:function(dataSource,i){var dsKey="ds"+i;var path=["dataSources",i];var schemaLink=makeSchemaLink(dataSource.get("schemaUrl"));return React.createElement("div",{key:dsKey,className:"dataSourceSubsection"},React.createElement("div",{className:"sortHandle"},React.createElement("span",{className:"floatLeft"},React.createElement(Icon,{type:"upDown",className:"sectionItem"}),React.createElement("span",{className:"boldText sectionItem"},dataSource.get("label")),React.createElement("span",{className:"sectionItem"},schemaLink)),React.createElement(Icon,{type:"x",className:"floatRight",update:this.props.update,path:path.concat("remove")}),React.createElement("div",{className:"clear"})))},renderDataSources:function(dataSources){if(dataSources&&dataSources.size){return React.createElement(Sortable,{sortableConfig:{handle:".sortHandle",axis:"y"},path:["dataSources","reorder"],update:this.props.update,className:"subsectionBox"},dataSources.map(this.renderDataSource).toJS())}else{return React.createElement("div",{className:"subsectionBox"},React.createElement("span",{className:"disabledMessage"},"please add at least one data source"))}},render:function(){var addDsInfo=this.props.addDsInfo;var querySpec=this.props.querySpec;if(!(addDsInfo&&querySpec)){return React.createElement(Section,{title:"Loading..."})}else{var dataSources=querySpec.get("dataSources");var outputInfo=querySpec.get("outFileOptions")||Immutable.Map();var tableFields=this.props.tableFields;var disableGetOutput=!(dataSources&&dataSources.size);var disableGetOutputMessage=React.createElement("span",{className:"disabledMessage"},"At least one data source must be added.");return React.createElement("div",null,React.createElement(Section,{title:"Configure Data Sources"},this.renderDataSources(dataSources),React.createElement(AddDataSource,{addDsInfo:addDsInfo,path:[],update:this.props.update})),React.createElement(Section,{title:"Output Options"},React.createElement(OutFileOptions,{options:outputInfo,fieldInfo:tableFields,showLoadingImage:this.props.showLoadingImage,disableGetOutput:disableGetOutput,disableGetOutputMessage:disableGetOutputMessage,path:["outFileOptions"],update:this.props.update})))}}});var DbPosAndQueryBuilder=React.createClass({displayName:"DbPosAndQueryBuilder",mixins:[PathUpdate,ImmutableUpdate],propTypes:{cladeOrgDbInfo:pt.object,regionSelect:pt.object,querySpec:pt.object,addDsInfo:pt.object,tableFields:pt.object,showLoadingImage:pt.bool},render:function(){var path=this.props.path;var cladeOrgDbInfo=this.props.cladeOrgDbInfo;if(!cladeOrgDbInfo){return React.createElement(Section,{title:"Loading..."})}else{return React.createElement("div",null,React.createElement(Section,{title:"Select Genome Assembly and Region"},React.createElement(CladeOrgDb,{menuData:cladeOrgDbInfo,path:path.concat("cladeOrgDb"),update:this.props.update}),React.createElement(RegionSelect,{regionSelect:this.props.regionSelect,db:cladeOrgDbInfo.get("db"),path:path.concat("regionSelect"),update:this.props.update})),React.createElement(QueryBuilder,{addDsInfo:this.props.addDsInfo,querySpec:this.props.querySpec,tableFields:this.props.tableFields,showLoadingImage:this.props.showLoadingImage,path:path,update:this.props.update}))}}});function helpSection(){return React.createElement(Section,{title:"Using the Data Integrator"},React.createElement("p",null,"The Data Integrator finds items in different tracks that overlap by position,"+" "+"and unlike the Table Browser's intersection function, the Data"+" "+"Integrator can output all fields from all selected tracks.  Up to 5"+" "+"different tracks may be queried at a time."),React.createElement("p",null,"This section contains a brief overview of Data Integrator controls."+" "+"For more information on using the tools,"+" "+"see the ",React.createElement("a",{href:"../goldenPath/help/hgIntegratorHelp.html"},"Data"+" "+"Integrator User's Guide"),"."),React.createElement("p",null,React.createElement("b",null,"Select Genome Assembly and Region"),React.createElement("br",null),"The controls in this section are for selecting a genome assembly and region to search.",React.createElement("ul",null,React.createElement("li",null,React.createElement("b",null,"group"),":"+" "+"A species group: Mammal, Vertebrate, Insect etc."),React.createElement("li",null,React.createElement("b",null,"genome"),":"+" "+"A single species such as Human or Mouse."),React.createElement("li",null,React.createElement("b",null,"assembly"),":"+" "+"A version of the reference genome assembly such as GRCh37/hg19."))),React.createElement("p",null,React.createElement("b",null,"Configure Data Sources"),React.createElement("br",null),"Currently selected data sources (tracks, custom tracks, hub tracks etc) are listed"+" "+"with ",React.createElement(Icon,{type:"upDown"})," icons"+" "+"for reordering the data sources."+" "+"The first data source is special in that data from the remaining data sources appear"+" "+"only when they overlap with the first data source."+" "+'Under "',React.createElement("b",null,"Add Data Source"),'", several menus display available data sources:',React.createElement("ul",null,React.createElement("li",null,React.createElement("b",null,"track group"),":"+" "+'A category of data track, for example "Genes and Gene Prediction"'+" "+'or "Regulation".'),React.createElement("li",null,React.createElement("b",null,"track"),":"+" "+"One or more data tables containing results of an experiment"+" "+"or a group of closely related experiments."),React.createElement("li",null,React.createElement("b",null,"table"),":"+" "+"This appears only when the selected track has more than one data table.")),"These sections can be reordered by dragging on the section title or arrow icon on the left."+" "+"To remove a section, click"+" "+"the ",React.createElement(Icon,{type:"x"})," icon"+" "+"to the right of the title."+" "+"Click on the Add button to add a new data source."),React.createElement("p",null,React.createElement("b",null,"Output Options"),React.createElement("br",null),React.createElement("ul",null,React.createElement("li",null,React.createElement("b",null,"Send output to file"),":"+" "+"check this box to have output sent to a local file"+" "+"instead of to the web browser window.",React.createElement("br",null),"When this is checked, additional options appear:",React.createElement("ul",null,React.createElement("li",null,React.createElement("b",null,"name"),":"+" "+"the file name to which output will be saved"),React.createElement("li",null,React.createElement("b",null,"compress with gzip"),":"+" "+"check this box to have the output file compressed by gzip (.gz)."+" "+"This saves disk space and may reduce network transfer time."))),React.createElement("li",null,React.createElement("b",null,"Choose fields"),":"+" "+"click this button to pop up a dialog box with a checkbox"+" "+"for each field of each data source.  If a checkbox is checked, that field will"+" "+"appear in the output."))))}var AppComponent=React.createClass({displayName:"AppComponent",mixins:[ImmutableUpdate],getDefaultProps:function(){return{path:[]}},render:function(){var appState=this.props.appState;var appStateJS=appState.toJS();console.log("top-level render:",appStateJS);var path=this.props.path;return React.createElement("div",{className:"cgiContents"},React.createElement("div",{className:"cgiTitleBox"},React.createElement("span",{className:"cgiTitle"},"Data Integrator"),React.createElement("input",{type:"button",value:"Undo",onClick:this.props.undo,disabled:!appState.get("canUndo")}),React.createElement("input",{type:"button",value:"Redo",onClick:this.props.redo,disabled:!appState.get("canRedo")})),React.createElement(DbPosAndQueryBuilder,{cladeOrgDbInfo:appState.get("cladeOrgDb"),regionSelect:appState.get("regionSelect"),addDsInfo:appState.get("addDsInfo"),querySpec:appState.get("hgi_querySpec"),tableFields:appState.get("tableFields"),showLoadingImage:appState.get("showLoadingImage"),path:path,update:this.props.update}),helpSection())}});AppComponent=AppComponent;